<%= form_for(rating, html: { class: 'form-inline' }) do |f| %>
  <%= f.hidden_field :home_id %>
  <%= f.hidden_field :aspect %>
  <%= f.hidden_field :score, id: "score_field_#{rating.aspect}" %>

  <% 1.upto(5).each do |score| %>
    <% rating_users = others_ratings.select { |r| r.score == score }.map { |r| r.user.display_name } %>
    <% btn_data = { score: score } %>
    <% btn_icon = rating_users.any? ? 'star-exclamation' : 'star' %>
    <% rating_users.unshift('You') if rating.score == score %>
    <% if rating_users.any? %>
      <%# We specify container: 'body' to avoid rendering problems in more complex components %>
      <% btn_data.merge!(toggle: :tooltip, container: :body) %>
      <% btn_title = "#{rating_users.to_sentence} rated this home's #{rating.aspect.humanize.downcase} #{score}/5" %>
    <% end %>

    <%= button_tag fa_icon(btn_icon, type: (rating.score.present? && rating.score >= score) ? :solid : :light),
                   type: :submit,
                   class: 'set_score_btn btn text-warning',
                   data: btn_data,
                   title: btn_title %>
  <% end %>
  &nbsp;
  <%= f.object.aspect.humanize %>
<% end %>

<script>
  $(function() {
    $('.set_score_btn').on('click', function(ev) {
      var btn = $(this);
      var score_field = $('#score_field_<%= rating.aspect %>');
      score_field.attr('value', btn.data('score'));
    });
  });
</script>
